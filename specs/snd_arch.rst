
RRPGE Audio architecture
==============================================================================

:Author:    Sandor Zsuga (Jubatian)
:Copyright: 2013 - 2014, GNU GPLv3 (version 3 of the GNU General Public
            License) extended as RRPGEv2 (version 2 of the RRPGE License): see
            LICENSE.GPLv3 and LICENSE.RRPGEv2 in the project root.




Introduction
------------------------------------------------------------------------------


This part defines how audio output is generated by the RRPGE system. In short
the system is capable to generate 8 bits digital stereo audio at 48 KHz
sampling frequency. Following the basic properties of this subsystem are
defined including the support of audio events.

Note that the Mixer is not covered in this part of the specification, check
"mix_arch.rst" for details on this component.




Basic properties of the audio output
------------------------------------------------------------------------------


The audio output capabilities of the system can be summarized as follows:

- Digital audio output only
- 8 bit unsigned sample data
- Two channel stereo output (mono output can be achieved using the mixer)
- The output is governed by hardware DMA
- 48 KHz sampling frequency is supported
- A DMA buffer size of 512 samples (256 words) per channel is supported
- Interrupt generation on buffer exhaustion

The audio output's interrupts should be used for the timing of the application
since the rate of this interrupt is fixed in real time (93.75 Hz).




DMA buffers
------------------------------------------------------------------------------


The audio DMA is capable to operate from the first 64 KWords (pages 0x4000 -
0x400F) of the Data memory. An 512 sample (256 words) block may be selected
individually for the Left and Right channels within this area.

The 0xEDE location (this repeats every 16 words within the 0xE00 - 0xFFF area)
within the Audio peripheral area selects the DMA buffers to use when the
currently output buffers are exhausted. This field is organized as follows:

- bit  8-15: Buffer select for Right channel
- bit  0- 7: Buffer select for Left channel

The buffer selects provide address bits 8 - 15. Buffers 0 - 13 are also
accessible within the Audio peripherial area (as it shadows Data memory page
0x4000 in the 0x000 - 0xDFF range).




Audio events (interrupts)
------------------------------------------------------------------------------


Audio interrupts may be generated if requested from the kernel (check
"Audio half-buffer exhausted" in "kernel.rst" for details).

If enabled, these events trigger when the audio DMA buffers are exhausted, and
the DMA hardware already loaded the pointers for the next buffer from 0xEDE.

This event normally should be used to update the DMA buffer pointers for the
subsequent 512 samples of audio data.

The event should also be used as a time base for the application providing a
stable, core and video timing independent 93.75 Hz rate.

Note that to provide smooth audio playback, this event should not be stalled
by more than about 10 milliseconds. Since it is the highest priority event,
and kernel tasks can not consume more than about 1ms in a burst, unless the
event handler itself contains extensive code this should not happen.
