
RRPGE Audio architecture
==============================================================================

:Author:    Sandor Zsuga (Jubatian)
:Copyright: 2013 - 2014, GNU GPLv3 (version 3 of the GNU General Public
            License) extended as RRPGEv1 (version 1 of the RRPGE License): see
            LICENSE.GPLv3 and LICENSE.RRPGEv1 in the project root.




Introduction
------------------------------------------------------------------------------


This part defines how audio output is generated by the RRPGE system. In short
the system is capable to generate 8 bits digital stereo audio at 24 or 48 KHz
sampling frequency. Following the basic properties of this subsystem are
defined including the support of audio events.

Note that the Mixer is not covered in this part of the specification, check
"mix_arch.rst" for details on this component.




Basic properties of the audio output
------------------------------------------------------------------------------


The audio output capabilities of the system can be summarized as follows:

- Digital audio output only
- 8 bit unsigned sample data
- Two channel stereo output (mono output can be requested)
- The output is governed by hardware DMA
- Sampling frequencies of 24 KHz and 48 KHz are supported
- DMA buffer sizes of 2 * 512 or 2 * 1024 samples per channel are supported
- Interrupt generation on buffer exhaustion

The properties of the audio output are defined in the application binary, and
are not possible to be changed while the application operates. The locations
of the audio DMA buffers are also fixed.

The audio output's interrupts can be used for the timing of the application as
well since they are fixed in real time (the events are timed according to the
selected audio frequency and buffer sizes).




DMA buffers
------------------------------------------------------------------------------


The audio output operates over a fixed area within the data memory. This is
the very beginning of the memory as seen by the user, that is, the buffers are
on page 0x4000. These buffers are so also visible on the Audio peripheral
area. Their sizes and layouts are as follows:

2 * 512 samples, Mono:

+---------------+------------------------------------------------------------+
| Range         | Description                                                |
+===============+============================================================+
| 0x000 - 0x0FF | Low half (512 samples)                                     |
+---------------+------------------------------------------------------------+
| 0x100 - 0x1FF | High half (512 samples)                                    |
+---------------+------------------------------------------------------------+

2 * 1024 samples, Mono:

+---------------+------------------------------------------------------------+
| Range         | Description                                                |
+===============+============================================================+
| 0x000 - 0x1FF | Low half (1024 samples)                                    |
+---------------+------------------------------------------------------------+
| 0x200 - 0x3FF | High half (1024 samples)                                   |
+---------------+------------------------------------------------------------+

2 * 512 samples, Stereo:

+---------------+------------------------------------------------------------+
| Range         | Description                                                |
+===============+============================================================+
| 0x000 - 0x0FF | Left low half (512 samples)                                |
+---------------+------------------------------------------------------------+
| 0x100 - 0x1FF | Left high half (512 samples)                               |
+---------------+------------------------------------------------------------+
| 0x200 - 0x2FF | Right low half (512 samples)                               |
+---------------+------------------------------------------------------------+
| 0x300 - 0x3FF | Right high half (512 samples)                              |
+---------------+------------------------------------------------------------+

2 * 1024 samples, Stereo:

+---------------+------------------------------------------------------------+
| Range         | Description                                                |
+===============+============================================================+
| 0x000 - 0x1FF | Left low half (1024 samples)                               |
+---------------+------------------------------------------------------------+
| 0x200 - 0x3FF | Left high half (1024 samples)                              |
+---------------+------------------------------------------------------------+
| 0x400 - 0x5FF | Right low half (1024 samples)                              |
+---------------+------------------------------------------------------------+
| 0x600 - 0x7FF | Right high half (1024 samples)                             |
+---------------+------------------------------------------------------------+




Audio events (interrupts)
------------------------------------------------------------------------------


Audio interrupts may be generated if requested from the kernel (check
"Audio half-buffer exhausted" in "kernel.rst" for details).

If enabled, these events trigger when the audio DMA passes a half buffer
boundary, that is after every 512 or 1024 samples depending on how the
application was set up.

The event should also be used as a time base for the application, which case
it provides the following rates depending on the audio settings of the
application:

- 23.4375 Hz (24 KHz sample rate, 1024 sample half buffer).
- 46.8750 Hz (48 KHz / 1024 samples or 24KHz / 512 samples half buffer).
- 93.7500 Hz (48 KHz sample rate, 512 sample half buffer).
